name: Build and Push Docker Image

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build-and-push:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

 #     - name: Log in to Docker Hub
 #       uses: docker/login-action@v2
 #       with:
 #         username: ${{ secrets.DOCKER_USERNAME }}
 #         password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Build and push Docker images for arm64
        env:
          PLATFORM: arm64
        run: |
          export PLATFORM=arm64
          ./build.sh
          ./build.sh test
#          ./build.sh push

      - name: Build and push Docker images for amd64
        env:
          PLATFORM: amd64
        run: |
          export PLATFORM=amd64
          ./build.sh
          ./build.sh test
#          ./build.sh push
